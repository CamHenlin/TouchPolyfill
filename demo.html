<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Touch Test</title>
    <link rel="Stylesheet" href="../bootstrap/css/bootstrap.css" />
</head>
<body>

<canvas id='backgroundCanvas' width='1000' height='1000' style='z-index:2; position:absolute;'>
</canvas>

Currently detected touch events:
<div style='height:20em; overflow:hidden; border:solid 1px gray' />
    <table id='touchPropertiesTable' class="table table-striped">
        <thead id='touchPropertiesTableHead'>            
        </thead>
        <tbody id = 'touchPropertiesTableBody'>
            <!-- Javascript is used to fill in this table when the user touches the screen -->
        </tbody>
    </table>
</div>
<div>
    <table id='counterTable' class='table table-striped'>
        <thead id='counterTableHead'>
        </thead>
        <tbody id='counterTableBody'>
            <!-- Javascript is used to fill in this table when the user touches the screen -->
        </tbody>
    </table>
</div>

</body>
<script src="touchpolyfill.js">
</script>

<script>
    'use strict';
    var touchTableMethods, counterTableMethods, canvasMethods, touchEventCounters;
   
    function touch(e) {
        var numberOfTouches, propertyList, i;

        e.preventDefault();

        counterTableMethods.printData(touchEventCounters);

        touchTableMethods.clearTable();
        canvasMethods.clearCanvas();

        propertyList = getPropertyList(e.touches[0])
        touchTableMethods.printHeader(propertyList);

        numberOfTouches = e.touches.length;
        for (i = 0; i < numberOfTouches; i++) {
            touchTableMethods.printData(e.touches[i], propertyList);
            canvasMethods.drawCircle(e.touches[i]);
        }
    }

    function touchStart(e) {
        touchEventCounters.start += 1;
        touch(e);
    }

    function touchEnd(e) {
        touchEventCounters.end += 1;
        touch(e);
    }

    function touchMove(e) {
        touchEventCounters.move += 1;
        touch(e);
    }

    function touchCancel(e) {
        toucheventcounters.cancel += 1;
        touch(e);
    }

    // Return an array containing the names of the properties of the touch object.
    function getPropertyList(touch) {
        var array, x;
        array = [];
        for (x in touch) {
            array.push(x);
        }
        return array;
    }

    touchEventCounters = {
        start: 0,
        end: 0,
        move: 0,
        cancel: 0
    }

    window.addEventListener("touchstart", touchStart, false);
    window.addEventListener("touchend", touchEnd, false);
    window.addEventListener("touchmove", touchMove, false);
    window.addEventListener("touchcancel", touchCancel, false);

    // Prevent the touch events from raising a context menu.
    window.addEventListener('contextmenu', function (e) { e.preventDefault(); });

    //    document.ontouchstart = touch;
    //    document.ontouchend = touch;
    //    document.ontouchmove = touch;
    //    document.ontouchcancel = touch;

    // This creates a closure for the methods that print data about touch events in a table.
    touchTableMethods = (function () {
        var touchPropertiesTableHead, touchPropertiesTableBody;

        function clearTable() {
            touchPropertiesTableHead.innerHTML = '';
            touchPropertiesTableBody.innerHTML = '';
        }

        function printHeader(propertyList) {
            touchPropertiesTableHead.innerHTML = '<tr><th>' + propertyList.join('</th><th>') + '</th></tr>';
        }

        function printData(touch, propertyList) {
            var i, rowHtml;
            rowHtml = [];
            for (i = 0; i < propertyList.length; i++) {
                rowHtml.push('<td>' + touch[propertyList[i]] + '</td>');
            }
            touchPropertiesTableBody.innerHTML += rowHtml.join('');
        }

        touchPropertiesTableHead = document.getElementById('touchPropertiesTableHead');
        touchPropertiesTableBody = document.getElementById('touchPropertiesTableBody');        

        return {
            clearTable: clearTable,
            printHeader: printHeader,
            printData: printData
        };
    })();

    counterTableMethods = (function () {
        var counterTableHead, counterTableBody;

        function printData(touchEventCounters) {
            var bodyHtml;

            bodyHtml = [
                '<tr><td>touchstart</td><td>',
                touchEventCounters.start,
                '</td></tr><tr><td>touchend</td><td>',
                touchEventCounters.end,
                '</td></tr><tr><td>touchmove</td><td>',
                touchEventCounters.move,
                '</td></tr><tr><td>touchcancel</td><td>',
                touchEventCounters.cancel,
                '</td><td></tr>'
            ].join('');

            counterTableBody.innerHTML = bodyHtml;
        }

        counterTableHead = document.getElementById('counterTableHead');
        counterTableBody = document.getElementById('counterTableBody');

        return {
            printData: printData
        };
    })();

    // This creates a closure for the methods that print circles where the user touches the screen.
    canvasMethods = (function () {
        var backgroundCanvas, context;

        backgroundCanvas = document.getElementById('backgroundCanvas');
        context = backgroundCanvas.getContext('2d');

        // Draw a white square over the entirety of the canvas.
        function clearCanvas() {            
            context.clearRect(0, 0, backgroundCanvas.width, backgroundCanvas.height);
        }

        function drawCircle(touch) {
            context.beginPath();
            context.arc(touch.clientX, touch.clientY, 50, 0, 2 * Math.PI, false);
            context.fillStyle = 'green';
            context.fill();
            context.lineWidth = 5;
            context.strokeStyle = '#003300';
            context.stroke();
        }

        return {
            clearCanvas: clearCanvas,
            drawCircle: drawCircle
        };
    })();
</script>
</html>
